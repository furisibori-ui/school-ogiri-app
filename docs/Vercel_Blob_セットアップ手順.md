# Vercel Blob のセットアップ手順

**中学生でもわかるように**書いてあります。

---

## そもそも「Blob」って何？

**Blob（ブロブ）** は、画像や音声などのファイルをインターネット上に保存しておく場所のことです。

- 学校の画像や校歌の音声を、ずっと残しておける「保管庫」だと思ってください
- 作った学校を友達にURLで共有するときに、この保管庫がないと画像や音声が消えてしまいます
- Vercel というサービスが、この保管庫を無料で貸してくれます

---

## すでに保管庫を作っている場合

**画像生成で Blob を使っているなら、新しく作る必要はありません。**

このアプリでは、もともと画像生成のときに Blob を使っています（`generate-school-image` で data URL を Blob にアップロード）。その**同じ保管庫**に、今回の「永続化」用のファイルが `school-persisted/` というフォルダで追加で保存されるだけです。

- 別の保管庫を作る必要はありません
- `BLOB_READ_WRITE_TOKEN` がすでに設定されていれば、そのまま使えます

---

## まだ保管庫を作っていない場合

やることの流れ（3ステップ）：

1. Vercel のサイトで「保管庫」を作る
2. パスワードのようなもの（トークン）が自動で設定される
3. それで完了！

---

## ステップ1：Vercel にログインする

※ すでに Blob を使っている場合は、このセットアップはスキップしてOKです。

1. ブラウザで [vercel.com](https://vercel.com) を開く
2. 右上の **Log in** をクリック
3. GitHub のアカウントでログインする（なければ作る）

---

## ステップ2：プロジェクトを選ぶ

1. ログインしたら、自分のプロジェクト一覧が表示される
2. **school-ogiri-app**（学校大喜利アプリ）の名前をクリック
3. プロジェクトのページが開く

---

## ステップ3：保管庫（Blob）を作る

1. 画面上の方にあるタブを探す
   - **Overview**（概要）・**Deployments**（デプロイ）・**Settings**（設定）… などが並んでいる
2. **Storage**（ストレージ＝保管庫）というタブをクリック
3. **Create Database** または **Add Storage** というボタンを探してクリック
4. 種類を選ぶ画面が出るので、**Blob** を選ぶ
5. 名前を入力する
   - 例：`school-ogiri-blob`（何でもOK。わかりやすい名前で）
6. **Create**（作成）をクリック

これで保管庫の作成は完了です。

---

## ステップ4：自動で設定されたか確認する

保管庫を作ると、Vercel が自動で「パスワード」を設定してくれます。

- **環境変数**（かんきょうへんすう）＝ プログラムが使う秘密の設定のことで、ここに「Blob にアクセスするためのパスワード」が入ります
- 名前は `BLOB_READ_WRITE_TOKEN` という長い名前です

**確認のしかた：**

1. プロジェクトの **Settings**（設定）タブをクリック
2. 左のメニューから **Environment Variables** をクリック
3. 一覧に `BLOB_READ_WRITE_TOKEN` が表示されていればOK
4. **Production** にチェックが入っていることを確認

何も表示されない場合は、上記の「ステップ3」で保管庫が正しく作れているか、もう一度確認してください。

---

## これで完了！

- **すでに Blob を設定していた人** → 何もしなくてOK。そのまま使えます。
- **今初めて設定した人** → ここまでできれば、学校を生成したときに画像や音声が自動で保管庫に保存されます。

無料で使える量：画像・音声が合計 **1GB** まで。学校1つあたり約 10MB くらいなので、**100 個くらい**の学校を保存できます。

---

## うまく動いているか確認する方法

1. アプリで学校を1つ生成する
2. 生成が終わったら、Vercel の **Logs**（ログ）タブを開く
3. 検索ボックスに `step5 blob persist done` と入力して検索
4. この文字が出ていれば、保管庫への保存が成功しています

---

## 困ったときは

| こんなとき | どうするか |
|------------|------------|
| 「step5 blob persist failed」と出る | 保管庫が作れているか、もう一度確認。Settings の Environment Variables に `BLOB_READ_WRITE_TOKEN` があるか確認。 |
| 画像が表示されない | ブラウザの開発者ツール（F12キー）で、画像のURLを確認。`vercel-storage.com` という文字が含まれていればOK。 |
| 音声が再生されない | 元の音声は数十分で消えるので、保管庫に保存されたURLに置き換わっているか確認。 |

---

## ローカル（自分のパソコン）で開発するとき

自分のパソコンでアプリを動かしてテストしたいときは、次のコマンドを実行します：

```bash
# まず Vercel のツールを入れる（1回だけ）
npm i -g vercel

# 環境変数を自分のパソコンにコピーする
vercel env pull .env.local
```

これで、ローカルでも保管庫を使えるようになります。
